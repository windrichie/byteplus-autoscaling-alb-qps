# BytePlus ALB QPS-based AutoScaling Configuration
# Copy this file to .env and fill in your actual values

# === REQUIRED CONFIGURATION ===

# BytePlus Cloud Configuration
AUTOSCALING_GROUP_ID=asg-xxxxx
ALB_ID=alb-xxxxx
REGION=ap-southeast-1
ACCESS_KEY_ID=AKAPMzIzNjI3OGM3ZjBmNDUyZGJiYWFiOGE3MDZjZTFhYzI
SECRET_ACCESS_KEY=WVRsbU1EazRaR1kwTjJGaE5HSTJabUZoTURnMU9XSTBPV0UxTW1ReFl6TQ==

# === CORE SCALING PARAMETERS ===

# Target QPS per instance (adjust based on your workload)
TARGET_QPS_PER_INSTANCE=10

# Scaling thresholds (0.0 to 1.0)
# Scale up when QPS per instance exceeds 80% of target
SCALE_UP_THRESHOLD=0.8
# Scale down when QPS per instance falls below 60% of target
SCALE_DOWN_THRESHOLD=0.4

# === INSTANCE LIMITS ===
# Note: Min/Max/Desired instances are now fetched from ASG at runtime
# Configure these values in your BytePlus AutoScaling Group instead

# === SCALING BEHAVIOR ===

# Number of instances to add/remove per scaling action
SCALE_UP_INCREMENT=1
SCALE_DOWN_DECREMENT=1
# Maximum instances to change per hour (velocity limit)
MAX_SCALING_VELOCITY=20

# === COOLDOWN PERIODS (seconds) ===

# Minimum time between scale-up actions
SCALE_UP_COOLDOWN=300
# Minimum time between scale-down actions
SCALE_DOWN_COOLDOWN=600
# Minimum time between any scaling actions
GENERAL_COOLDOWN=180

# === METRIC COLLECTION ===

# Period for metric aggregation (seconds)
METRIC_PERIOD=300

# === STORAGE CONFIGURATION ===

# TOS mount path (configured in FaaS)
TOS_MOUNT_PATH=/mnt/tos
# State file name
TOS_STATE_FILE=scaling_state.json

# === API CONFIGURATION ===

# API request timeout (seconds)
API_TIMEOUT=30
# Number of API retries on failure
API_RETRY_COUNT=3

# === SAFETY & MONITORING ===

# Enable dry run mode (no actual scaling, just logging)
DRY_RUN_MODE=false
# Webhook URL for scaling alerts (optional)
ALERT_WEBHOOK_URL=
# Enable metric anomaly detection
METRIC_ANOMALY_DETECTION=true

# === FUNCTION BEHAVIOR ===

# Logging level (DEBUG, INFO, WARN, ERROR)
LOG_LEVEL=INFO
# Enable detailed logging (includes function names, line numbers)
ENABLE_DETAILED_LOGGING=false
# Initial delay in seconds for staggered execution (0 = no delay)
INITIAL_DELAY_SECONDS=0

# === EXAMPLE CONFIGURATIONS ===

# High-traffic web application
# TARGET_QPS_PER_INSTANCE=100
# SCALE_UP_THRESHOLD=0.7
# SCALE_DOWN_THRESHOLD=0.5
# MIN_INSTANCES=2
# MAX_INSTANCES=20

# GPU ML inference workload
# TARGET_QPS_PER_INSTANCE=20
# SCALE_UP_THRESHOLD=0.8
# SCALE_DOWN_THRESHOLD=0.4
# MIN_INSTANCES=1
# MAX_INSTANCES=5
# SCALE_UP_COOLDOWN=600
# SCALE_DOWN_COOLDOWN=1200

# Development/testing environment
# TARGET_QPS_PER_INSTANCE=10
# MIN_INSTANCES=0
# MAX_INSTANCES=3
# DRY_RUN_MODE=true
# LOG_LEVEL=DEBUG
# ENABLE_DETAILED_LOGGING=true